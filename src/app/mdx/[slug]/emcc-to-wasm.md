## emcc 编译 wasm

距离上次写cpp已经是8年前大一那会写的期末代码，作为切图菜鸟，接触这种东西确实让人头疼。

编译出来的wasm总是不能被浏览器api解析或者webpack import。主要是emcc参数编译库错了，**中文官网文档也是坑爹，不当人**。

[Emscripten 3.1.9-git (dev) documentation](https://emscripten.org/)

特别指出：window安装emcc环境，环境变量需要自己手写。


---


emcc是webassemble的[编译器](https://so.csdn.net/so/search?q=%E7%BC%96%E8%AF%91%E5%99%A8&spm=1001.2101.3001.7020)，类似于gcc的作用。

emcc编译C/C++代码的流程：

C/C++代码通过emcc编译为字节码，然后根据不同的目标编译为asm.js或wasm。emcc和gcc编译选项类似，例如-s OPTIONS=VALUE、-O等。另外为了适应Web环境，emcc增加了一些特有的选项，如–pre-js 、–post-js 等。

setting.js里边有编译关键参数。




---


```plain
emcc hello.c -O3 -s SIDE_MODULE=1 -o hello.wasm
```
切图仔需要的库一般这么构建出wasm就可以直接被**浏览器API使用**。
但是，webpack5是直接支持导入的，不过要添加实验性参数。

重要的是，如果你用的cra，需要在file-loader中去掉wasm后缀的文件，**否则会被file-loader捕获**。

总的来讲就是这个不能被任何loader捕获，webpack5自带解析。

```plain
    experiments: {
      asyncWebAssembly: true,
      syncWebAssembly: true
    },
```
编译后直接像普通module一样import就行了。
```plain
import * as main from './hello.wasm'
```
打印mdin
![图片](data:image/png;base64,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)


添加图片注释，不超过 140 字（可选）


---


也尝试了一下用golang去写，但是go的支持有点烂，文档也是迷得飞起，比cpp麻烦太多。或许rust比较好些，但是我选择cpp。

